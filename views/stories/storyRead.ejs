<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="<%=pageDescription%>">
    <title>
        <%=pageTitle %>
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/moment/min/moment.min.js"></script>
    <script src="https://kit.fontawesome.com/0790e1818c.js" crossorigin="anonymous"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .share-btn {
            background-color: #007bff;
            color: white;
            padding: 8px 12px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }

        .share-options {
            margin-top: 10px;
        }

        .share-options a {
            text-decoration: none;
            margin-right: 8px;
            color: #007bff;
        }

        .dark body {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        .light body {
            background-color: #f8f9fa;
            color: #333;
        }

        .story-text {
            font-family: 'Merriweather', serif;
            line-height: 1.8;
            white-space: pre-wrap;
            font-size: 1.1rem;
        }

        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .dropdown-menu {
            opacity: 0;
            transform: translateY(-10px);
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .dropdown-menu.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .story-container {
            max-width: 800px;
            margin: 0 auto;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            border-radius: 8px;
            padding: 2rem;
        }

        .dark .story-container {
            background-color: #000000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .light .story-container {
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .comment-form {
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .dark .comment-form textarea {

            color: black;
        }

        /* .comment-form:focus-within {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        } */

        .comment-card {
            transition: all 0.2s ease;
        }

        .comment-card:hover {
            transform: translateY(-2px);
        }

        .dark .comment-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
        }

        .light .comment-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }

        .fab-button {
            transition: all 0.3s ease;
        }

        .fab-button:hover {
            transform: scale(1.05);
        }

        .scroll-indicator {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(to right, #3b82f6, #60a5fa);
            z-index: 1000;
            width: 0%;
            transition: width 0.1s ease;
        }

        /* Dark mode toggle switch */
        .theme-toggle {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .theme-toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.theme-toggle-slider {
            background-color: #3b82f6;
        }

        input:checked+.theme-toggle-slider:before {
            transform: translateX(24px);
        }

        /* Dark mode color adjustments */
        .dark .bg-white {
            background-color: #2a2a2a;
        }

        .dark .bg-gray-50 {
            background-color: #333;
        }

        .dark .text-gray-800 {
            color: #e0e0e0;
        }

        .dark .text-gray-700 {
            color: #d0d0d0;
        }

        .dark .text-gray-600 {
            color: #b0b0b0;
        }

        .dark .text-gray-500 {
            color: #a0a0a0;
        }

        .dark .border-gray-200 {
            border-color: #3a3a3a;
        }

        .dark .shadow-sm {
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
        }

        .dark .hover\:bg-gray-100:hover {
            background-color: #3a3a3a;
        }

        .dark .hover\:text-gray-700:hover {
            color: #ffffff;
        }

        .dark .username {
            color: white;
        }

        .dark .comment {
            color: white;
        }

        .dark .story-stats {
            color: white;
        }

        .dark .author-username {
            color: white;
        }

        .dark .nav-content a {
            color: white;
        }
    </style>
</head>

<body class="bg-gray-50">


    <div class="scroll-indicator" id="scroll-indicator"></div>

    <!-- Navbar -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">

                <div class="flex items-center justify-between">

                    <div class="flex-shrink-0 flex items-center">
                        <a href="/stories">
                            <span class="text-2x1 font-bold">
                                <i class="fa-solid fa-feather"></i> Diary
                            </span>
                        </a>
                    </div>

                    <!-- Desktop Navigation Links -->
                    <div class="hidden md:ml-8 md:flex md:space-x-8">
                        <a href="/stories"
                            class="flex items-center username h-16 px-2 text-sm font-medium text-gray-900 border-b-2 border-accent">
                            <i class="fas fa-book text-accent mr-2"></i>
                            <span>Stories</span>
                        </a>
                        <a href="/stories/newWrite"
                            class="flex items-center h-16 px-2 text-sm font-medium text-gray-500 hover:text-gray-900 border-b-2 border-transparent hover:border-primary-400 transition-all duration-200">
                            <i class="fas fa-feather-alt text-primary-500 mr-2"></i>
                            <span>Write</span>
                        </a>
                    </div>
                </div>

                <div class="flex items-center">
                    <button id="theme-toggle" class="p-2 rounded-full  ">
                        <i id="theme-icon" class="ri-sun-line text-gray-800 dark:text-gray-700"></i>
                    </button>

                    <!-- Search button -->
                    <div class="flex-shrink-0 mr-2">
                        <a href="/search">
                            <button
                                class="p-2 rounded-full bg-primary-50 hover:bg-primary-100 text-primary-600 transition-all duration-200">
                                <i class="fas fa-search"></i>
                            </button>
                        </a>
                    </div>

                    <!-- Notification bell -->
                    <div class="flex-shrink-0 mr-2 relative">
                        <a href="/notification">
                            <button onclick="markNotificationsSeen()"
                                class="p-2 rounded-full bg-primary-50 hover:bg-primary-100 text-primary-600 transition-all duration-200">
                                <i class="fas fa-bell"></i>
                                <!-- Make sure the red dot has the correct ID -->
                                <span id="red-dot"
                                    class="red-dot absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 rounded-full bg-accent text-xs font-bold text-red-700 hidden">
                                    5 <!-- This number is dynamic, based on unread notifications -->
                                </span>
                            </button>
                        </a>
                    </div>

                    <!-- Profile dropdown -->
                    <div class="ml-3 relative">
                        <div>
                            <button id="profile-menu-button" type="button"
                                class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                                aria-expanded="false" aria-haspopup="true">
                                <img class="h-9 w-9 rounded-full object-cover border-2 border-primary-400"
                                    src="<%=user.image.url  %>" alt="User profile">
                            </button>
                        </div>

                        <!-- Dropdown menu -->
                        <div id="profile-dropdown"
                            class="hidden origin-top-right absolute right-0 mt-2 w-64 rounded-xl shadow-xl py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10 transform transition-all duration-200">
                            <div class="px-4 py-3 border-b border-gray-100">
                                <div class="flex items-center space-x-3">
                                    <img class="h-10 w-10 rounded-full object-cover border-2 border-primary-400"
                                        src="<%=user.image.url  %>" alt="User profile">
                                    <div>
                                        <p class="text-sm font-semibold text-gray-800">
                                            <%=user.name%>
                                        </p>
                                        <p class="text-xs text-gray-500">@<%=user.username%>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <a href="/dashbord"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-primary-50 hover:text-primary-700 transition-colors duration-200"
                                role="menuitem">
                                <i class="fas fa-chart-line mr-2 text-primary-500"></i> Dashboard
                            </a>
                            <a href="/profile"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-primary-50 hover:text-primary-700 transition-colors duration-200"
                                role="menuitem">
                                <i class="fas fa-user mr-2 text-primary-500"></i> Profile
                            </a>
                            <a href="/stories/newWrite"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-primary-50 hover:text-primary-700 transition-colors duration-200"
                                role="menuitem">
                                <i class="fas fa-pen-fancy mr-2 text-primary-500"></i> Write
                            </a>
                            <div class="border-t border-gray-100 mt-1">
                                <a href="/logout"
                                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-700 transition-colors duration-200"
                                    role="menuitem">
                                    <i class="fas fa-sign-out-alt mr-2 text-red-500"></i> Sign out
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile menu button -->
                    <div class="md:hidden ml-2">
                        <button id="mobile-menu-button" type="button"
                            class="inline-flex items-center justify-center p-2 rounded-md text-primary-500 hover:text-primary-700 hover:bg-primary-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500"
                            aria-controls="mobile-menu" aria-expanded="false">
                            <i class="fas fa-bars text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="py-3 space-y-1 px-4">
                <a href="#"
                    class="flex items-center px-3 py-2 rounded-lg bg-gradient-to-r from-primary-50 to-primary-100 text-primary-700 font-medium">
                    <i class="fas fa-book mr-3 text-primary-600"></i>
                    <span>Stories</span>
                </a>
                <a href="#"
                    class="flex items-center px-3 py-2 rounded-lg text-gray-600 hover:bg-gradient-to-r hover:from-accent-light/10 hover:to-primary-100 hover:text-primary-700 font-medium transition-all duration-200">
                    <i class="fas fa-feather-alt mr-3 text-accent"></i>
                    <span>Write</span>
                </a>
            </div>
        </div>
    </nav>



    <!-- Toast Notifications -->
    <div class="fixed top-5 right-5 z-50">
        <% if(success && success.length) { %>
            <div id="toast-success" class="flex items-center p-4 mb-4 bg-white rounded-lg shadow animate-fadeIn"
                role="alert">
                <div
                    class="inline-flex flex-shrink-0 justify-center items-center w-8 h-8 rounded-lg bg-green-100 text-green-500">
                    <i class="ri-check-line"></i>
                </div>
                <div class="ml-3 text-sm font-normal text-gray-800">
                    <%=success %>
                </div>
                <button type="button"
                    class="ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg p-1.5 hover:bg-gray-100 inline-flex h-8 w-8"
                    id="close-toast">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            <% } %>
    </div>

    <!-- Delete Modal -->
    <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div
            class="bg-white rounded-lg shadow-lg w-11/12 md:w-1/3 p-6 transform transition-all duration-300 ease-in-out">
            <div class="flex justify-between items-center border-b pb-3">
                <h3 class="text-lg font-semibold text-gray-900">Delete Story</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mt-4">
                <p class="text-gray-700">Are you sure you want to delete this story? This action cannot be undone.</p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancelBtn"
                    class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors">Cancel</button>
                <form action="/stories/<%=story._id%>/delete?_method=DELETE" method="post">
                    <button
                        class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors">Delete</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Story Container -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Story Content -->
            <div class="w-full lg:w-2/3">
                <div class="bg-white shadow-sm rounded-lg overflow-hidden">
                    <!-- Story Header -->
                    <div class="bg-gradient-to-r from-black-500 to-indigo-600 px-6 py-8 text-black">
                        <h1 class="text-3xl font-bold text-center mb-4 username">
                            <%=story.title.toUpperCase()%>
                        </h1>
                        <div class="flex justify-center">
                            <img src="<%=story.image.url%>" alt="<%=story.title%>"
                                class="h-72 w-full object-cover rounded-lg shadow-md">
                        </div>
                        <!-- <div class="flex items-center justify-center mt-4">
                            <a href="/profile/<%=story.owner._id%>" class="flex items-center">
                                <div class="flex-shrink-0">
                                    <img class="h-8 w-8 rounded-full" src="<%=story.owner.image.url%>" alt="<%=story.owner.username%>">
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-white"><%=story.owner.username%></p>
                                </div>
                            </a>
                        </div> -->
                    </div>

                    <!-- Story Content -->
                    <div class="px-4 py-8">
                        <div class="story-text">
                            <%= story.story %>
                        </div>
                    </div>

                    <!-- Story Actions -->
                    <div class="border-t border-gray-200 px-6 py-4">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <form action="/stories/<%=story._id%>/likes" class="flex items-center">
                                    <button type="submit"
                                        class="text-gray-400 hover:text-red-500 focus:outline-none transition-colors">
                                        <% if(story.likedBy.includes(currUser.id)) { %>
                                            <i class="ri-heart-3-fill text-red-500 text-xl"></i>
                                            <% } else { %>
                                                <i class="ri-heart-add-2-line text-xl"></i>
                                                <% } %>
                                    </button>
                                    <span class="ml-2 text-gray-600 font-medium">
                                        <%=story.likesCounts%>
                                    </span>
                                </form>

                                <div class="ml-4 text-gray-600">
                                    <i class="ri-chat-3-line text-xl"></i>
                                    <span class="ml-1">
                                        <%=story.comments.length%>
                                    </span>
                                </div>
                            </div>

                            <div class="relative">
                                <button id="options-menu" class=" p-2 ">
                                    <i class="ri-more-2-fill"></i>
                                </button>
                                <div id="story-option" style="display: none;"
                                    class=" absolute  right-0 bottom-10 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10">
                                    <% if (story.owner._id.equals(currUser._id)) { %>
                                        <a href="/stories/<%=story._id%>/edit"
                                            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                            <i class="ri-pencil-line mr-2"></i> Edit
                                        </a>
                                        <button id="openModalBtn"
                                            class="w-full text-left block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                            <i class="ri-delete-bin-6-line mr-2"></i> Delete
                                        </button>
                                        <% } %>
                                            <a href="/stories/download/<%=story._id%>"
                                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                <i class="ri-download-cloud-line mr-2"></i> Download
                                            </a>
                                            <a
                                                class="w-full text-left block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                                onclick="shareStory('<%= story._id %>')">

                                                <i class="ri-share-line mr-2"></i>   Share
                                        </a>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="mt-8 bg-white shadow-sm rounded-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-xl font-semibold text-gray-800">Comments (<%=story.comments.length%>)</h2>
                    </div>

                    <!-- Comment Form -->
                    <div class="p-6 border-b border-gray-200">
                        <form action="/comment/<%=story._id%>" method="post" class="comment-form">
                            <textarea name="comment[comment]" placeholder="Share your thoughts..." required
                                class="w-full px-4 py-3 rounded-lg border border-gray-300 resize-none"></textarea>
                            <div class="flex items-center justify-between mt-4">
                                <button id="gif-btn" type="button"
                                    class="flex items-center text-gray-600 hover:text-gray-800 transition-colors">
                                    <i class="ri-file-gif-line text-xl mr-1"></i>
                                    <span>Add GIF</span>
                                </button>
                                <button type="submit" class="btn-primary px-6 py-2 rounded-lg font-medium">
                                    Post Comment
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- GIF Picker -->
                    <div id="gif-container" class="hidden p-6 border-b border-gray-200">
                        <form id="comment-form" action="/gif/<%=story._id%>" method="post">
                            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                                <div class="p-4 border-b border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-lg font-medium text-gray-800">Select a GIF</h3>
                                        <button type="button" id="gif-cls" class="text-gray-400 hover:text-gray-600">
                                            <i class="ri-close-line text-xl"></i>
                                        </button>
                                    </div>
                                    <div class="flex items-center mt-4">
                                        <input type="text" id="gif-search" placeholder="Search for GIFs..."
                                            class="w-full px-4 py-2 rounded-lg border dark:text-black border-gray-300 ">
                                        <button type="button" onclick="searchGIFs()"
                                            class="ml-2 btn-primary px-4 py-2 rounded-lg font-medium">Search</button>
                                    </div>
                                </div>
                                <div id="gif-results"
                                    class="p-4 grid grid-cols-2 md:grid-cols-3 gap-4 max-h-64 overflow-y-auto">
                                    <!-- GIFs will be displayed here -->
                                </div>
                            </div>
                            <input type="hidden" name="gif" id="selected-gif">
                        </form>
                    </div>

                    <!-- Comments List -->
                    <div class="divide-y divide-gray-200">
                        <% for (review of story.comments) { %>
                            <div class="p-6 comment-card">
                                <div class="flex">
                                    <div class="flex-shrink-0 mr-4">
                                        <img class="h-10 w-10 rounded-full object-cover"
                                            src="<%=review.author.image.url%>" alt="<%=review.author.username%>">
                                    </div>
                                    <div class="flex-grow">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <a href="/comment/<%=review.author._id%>"
                                                    class="font-medium username  text-gray-900 hover:underline">
                                                    <%=review.author.username%>
                                                </a>
                                                <p class="text-xs text-gray-500" id="lastEdited-<%= review._id %>">
                                                    <%= review.timeStamp.toISOString() %>
                                                </p>
                                            </div>
                                            <% if (review.author._id.equals(currUser._id)) { %>
                                                <div class="flex space-x-2">
                                                    <a href="/comment/<%=story._id%>/review/<%=review._id%>"
                                                        class="text-sm text-gray-500 hover:text-gray-700">
                                                        <i class="ri-edit-line"></i>
                                                    </a>
                                                    <form
                                                        action="/comment/<%=story._id%>/review/<%=review._id%>?_method=DELETE"
                                                        method="post">
                                                        <button type="submit"
                                                            class="text-sm text-gray-500 hover:text-red-500">
                                                            <i class="ri-delete-bin-line"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                                <% } %>
                                        </div>
                                        <div class="mt-2 comment text-gray-700">
                                            <p>
                                                <%=review.comment%>
                                            </p>
                                            <% if (review.gif) { %>
                                                <div class="mt-2 ">
                                                    <img src="<%= review.gif %>" alt="GIF" class="rounded-lg max-w-60">
                                                </div>
                                                <% } %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="w-full lg:w-1/3 mt-6 lg:mt-0">
                <div class="bg-white shadow-sm rounded-lg overflow-hidden  sticky top-20">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-xl font-semibold text-gray-800">About the Author</h2>
                    </div>
                    <div class="p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <img class="h-10 w-10 rounded-full object-cover" src="<%=story.owner.image.url%>"
                                    alt="<%=story.owner.username%>">
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg author-username font-medium text-gray-900">
                                    <%=story.owner.username%>
                                </h3>
                                <a href="/profile/<%=story.owner._id%>"
                                    class="text-blue-600 hover:text-blue-800 text-sm">View Profile</a>
                            </div>
                        </div>
                        <div class="mt-6">
                            <h4 class="text-md story-stats font-medium text-gray-900">Story Stats</h4>
                            <div class="mt-2 grid grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <div class="text-sm text-gray-500">Likes</div>
                                    <div class="text-xl font-semibold">
                                        <%=story.likesCounts%>
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <div class="text-sm text-gray-500">Comments</div>
                                    <div class="text-xl font-semibold">
                                        <%=story.comments.length%>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Back to top button -->
    <button id="back-to-top"
        class="fixed bottom-6 right-6 bg-blue-600 text-white p-2 rounded-full shadow-lg opacity-0 invisible transition-all duration-300">
        <i class="ri-arrow-up-line text-xl"></i>
    </button>

    <script>
        // Toast notification
        setTimeout(() => {

            const toast = document.getElementById('toast-success');
            if (toast) {
                toast.classList.add('opacity-0');
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 300);
            }
        }, 3000);

        setTimeout(() => {
            document.getElementById('toast-success').style.display = "none"

            location.reload()
        }, 2000);


        document.getElementById('close-toast')?.addEventListener('click', () => {
            const toast = document.getElementById('toast-success');
            toast.classList.add('opacity-0');
            setTimeout(() => {
                toast.style.display = 'none';
            }, 300);
        });





        // Delete modal
        const openModalBtn = document.getElementById('openModalBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const modal = document.getElementById('modal');

        if (openModalBtn && modal) {
            openModalBtn.addEventListener('click', () => {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.querySelector('div').classList.add('scale-100');
                }, 10);
            });
        }

        if (closeModalBtn && modal) {
            closeModalBtn.addEventListener('click', () => {
                modal.querySelector('div').classList.remove('scale-100');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            });
        }

        if (cancelBtn && modal) {
            cancelBtn.addEventListener('click', () => {
                modal.querySelector('div').classList.remove('scale-100');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            });
        }

        // GIF search
        async function searchGIFs() {
            const query = document.getElementById('gif-search').value;
            if (!query) return;

            const resultsContainer = document.getElementById('gif-results');
            resultsContainer.innerHTML = '<div class="col-span-3 text-center py-4"><i class="ri-loader-4-line animate-spin text-2xl text-gray-400"></i></div>';

            try {
                const response = await fetch(`/search-gif?q=${query}`);
                const gifs = await response.json();

                resultsContainer.innerHTML = '';

                if (gifs.length === 0) {
                    resultsContainer.innerHTML = '<div class="col-span-3 text-center py-4">No GIFs found. Try another search.</div>';
                    return;
                }

                gifs.forEach(gif => {
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'border rounded-lg overflow-hidden cursor-pointer hover:border-blue-500 transition-colors';

                    const img = document.createElement('img');
                    img.src = gif.images.fixed_height.url;
                    img.className = 'w-full h-auto';
                    img.alt = 'GIF';

                    imgContainer.appendChild(img);
                    imgContainer.onclick = () => {
                        document.getElementById('selected-gif').value = gif.images.fixed_height.url;
                        document.getElementById('comment-form').submit();
                    };

                    resultsContainer.appendChild(imgContainer);
                });
            } catch (error) {
                resultsContainer.innerHTML = '<div class="col-span-3 text-center py-4">Something went wrong. Please try again.</div>';
            }
        }

        // GIF button toggle
        const gifBtn = document.getElementById('gif-btn');
        const gifContainer = document.getElementById('gif-container');
        const gifCloseBtn = document.getElementById('gif-cls');

        if (gifBtn && gifContainer) {
            gifBtn.addEventListener('click', () => {
                gifContainer.classList.toggle('hidden');
                if (!gifContainer.classList.contains('hidden')) {
                    document.getElementById('gif-search').focus();
                }
            });
        }

        if (gifCloseBtn && gifContainer) {
            gifCloseBtn.addEventListener('click', () => {
                gifContainer.classList.add('hidden');
                document.getElementById('gif-search').value = '';
                document.getElementById('gif-results').innerHTML = '';
            });
        }

        // Format timestamps
        document.querySelectorAll('[id^="lastEdited-"]').forEach(el => {
            const rawDate = new Date(el.innerText.trim());
            el.innerText = moment(rawDate).fromNow();
        });

    </script>
    <script>
        function shareStory(storyId) {
            const storyUrl = `${window.location.origin}/stories/${storyId}`; // Adjust URL based on your route

            if (navigator.share) {
                navigator.share({
                    title: "Check out this story!",
                    text: "Read this amazing story on Diary.",
                    url: storyUrl
                }).then(() => {
                    console.log("Story shared successfully!");
                }).catch((error) => {
                    console.error("Error sharing:", error);
                });
            } else {
                const shareLinks = {
                    whatsapp: `https://api.whatsapp.com/send?text=Read%20this%20story%20${encodeURIComponent(storyUrl)}`,
                    facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(storyUrl)}`,
                    twitter: `https://twitter.com/intent/tweet?url=${encodeURIComponent(storyUrl)}&text=Read%20this%20story`,
                    linkedin: `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(storyUrl)}&title=Amazing%20Story`,
                    telegram: `https://t.me/share/url?url=${encodeURIComponent(storyUrl)}&text=Read%20this%20story`
                };

                let shareOptions = `
                    <div class="share-options">
                        <a href="${shareLinks.whatsapp}" target="_blank">WhatsApp</a> |
                        <a href="${shareLinks.facebook}" target="_blank">Facebook</a> |
                        <a href="${shareLinks.twitter}" target="_blank">Twitter</a> |
                        <a href="${shareLinks.linkedin}" target="_blank">LinkedIn</a> |
                        <a href="${shareLinks.telegram}" target="_blank">Telegram</a>
                    </div>
                `;

                document.querySelector(".px-4.py-8").insertAdjacentHTML("beforeend", shareOptions);
            }
        }
    </script>

    <script>


        const optionsMenu = document.getElementById('options-menu');
        const storyOption = document.getElementById('story-option');
        optionsMenu.addEventListener('click', () => {

            if (storyOption.style.display === "block") {

                storyOption.style.display = "none";
            } else {

                storyOption.style.display = "block";
            }
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            checkUnreadNotifications(); // Run on page load

            //  Check for new notifications every 5 seconds
            setInterval(checkUnreadNotifications, 5000);
        });

        // Function to check unread notifications
        function checkUnreadNotifications() {
            fetch('/check-unread-notifications')
                .then(response => response.json())
                .then(data => {
                    const redDot = document.getElementById("red-dot");
                    if (data.success && data.unreadCount > 0) {
                        redDot.classList.remove("hidden");
                        redDot.textContent = data.unreadCount; =
                    } else {
                        redDot.classList.add("hidden");
                    }
                })
                .catch(error => console.error("Error fetching notifications:", error));
        }

        // Function to mark notifications as seen when clicked
        function markNotificationsSeen() {
            fetch('/mark-notifications-seen')
                .then(() => {
                    document.getElementById("red-dot").classList.add("hidden");
                })
                .catch(error => console.error("Error marking notifications as seen:", error));
        }


    </script>
    <script>


        // Dark mode toggle script
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.documentElement.classList.add('dark');
            themeIcon.classList.replace('ri-sun-line', 'ri-moon-line');
        }

        themeToggleBtn.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            const isDarkMode = document.documentElement.classList.contains('dark');
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            themeIcon.classList.toggle('ri-sun-line', !isDarkMode);
            themeIcon.classList.toggle('ri-moon-line', isDarkMode);
        });

        // Profile dropdown toggle
        const profileButton = document.getElementById('profile-menu-button');
        const profileDropdown = document.getElementById('profile-dropdown');

        profileButton.addEventListener('click', () => {
            profileDropdown.classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        window.addEventListener('click', (event) => {
            if (!profileButton.contains(event.target)) {
                profileDropdown.classList.add('hidden');
            }
        });

        // Mobile menu toggle
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    </script>


    <script>
        // page refresh keep scrolling position
        document.addEventListener("DOMContentLoaded", function (event) {
            var scrollpos = localStorage.getItem('scrollpos');
            if (scrollpos) window.scrollTo(0, scrollpos);
        });

        window.onbeforeunload = function (e) {
            localStorage.setItem('scrollpos', window.scrollY);
        };
    </script>
</body>

</html>